{"version":3,"sources":["components/utils/confirmation-dialog.tsx","hooks/use-combined-state.ts","components/voting-page/voting-session.module.scss","components/utils/editable-on-click.module.scss","components/voting-page/voting-results.module.scss","models/voting-types.ts","components/utils/editable-on-click.tsx","components/voting-page/voting-results.tsx","api/voting.ts","realtime/voting-connection.ts","components/voting-page/voting-session.tsx"],"names":["ConfirmationDialog","title","message","acceptText","cancelText","Trigger","renderTrigger","action","onSuccess","onError","useState","open","setOpen","loading","setLoading","handleClose","close","onClose","maxWidth","fullWidth","disableEscapeKeyDown","disableBackdropClick","aria-labelledby","aria-describedby","id","onClick","color","variant","disabled","actionReturn","isPromise","then","data","catch","error","finally","autoFocus","inCase","size","useCombinedState","initialState","useReducer","prevState","nextState","Object","assign","module","exports","Actions","EditableOnClick","onSubmit","disableEdit","initialText","validationRules","customErrorMsg","classes","placeholder","dispatch","useDispatch","maxLength","pattern","applyEditableStyle","setApplyEditableStyle","text","setText","Boolean","showPlaceholder","setShowPlaceholder","inputRef","useRef","useEffect","current","textContent","onMouseDown","undefined","contentEditable","className","styles","input","editable","empty","ref","href","returnIfLink","spellCheck","onBlur","submitted","test","length","showAlert","type","content","trim","onFocus","target","defaultValue","colors","VotingResults","memberVotes","aggs","keys","reduce","agg","member","vote","countPerVote","avgNominator","avgDenominator","roundedAvg","Math","round","chartData","map","i","value","container","avg","percentages","chart","label","dataEntry","labelStyle","fontSize","fill","fontWeight","votingUrl","process","votingOptions","indicativeVotingOptions","voted","unknown","initial","actionHandlers","closeSession","conn","showNewMember","msg","setState","newMember","state","members","removeLeavingMember","leavingMember","showCurrentMembers","currentUser","sessionModerator","currentMembers","membersOnTop","m","sessionCreated","currentUserIsSessionModerator","displaySubject","currentSubject","newState","toggleResultsDisplay","votes","show","currentMemberVotes","forEach","k","resultsAreShown","showVote","lockedOption","reset","changeModerator","newModeratorId","createActionSenders","submitVote","send","JSON","stringify","createSubmitVoteSender","createToggleResultsDisplaySender","createCloseSessionSender","subject","createDisplaySubjectSender","createResetSender","createChangeModeratorSender","isRunning","votesUiMap","Map","root","icon","getVoteInUi","get","Number","number","VotingSession","teamId","useParams","history","useHistory","teams","useSelector","team","loadingTeam","setTeamState","callApi","teamApi","getUrl","res","teamApiError","user","actionSenders","push","initialConn","WebSocket","modifiedSetState","onopen","onmessage","ev","parse","Array","isArray","onclose","onerror","e","initVotingSessionConn","handleCardClick","currentTarget","handleEndVoting","header","name","Button","body","admin","moderator","username","cards","o","getCssClasses","card","toString","results","stats","values","filter","v"],"mappings":"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","file":"static/js/7.a4323cf0.chunk.js","sourcesContent":["import React, { useState } from 'react';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\n\nimport ShowFirstChild from './show-first-child';\nimport { isPromise } from '../../utils/utils';\n\ninterface TriggerProps {\n  open: () => void;\n  close: () => void;\n};\n\nexport interface ConfirmationDialogProps {\n  title: string;\n  message?: string;\n  acceptText?: string;\n  cancelText?: string;\n  action: <T>() => any | Promise<T>;\n  renderTrigger: React.FC<TriggerProps>;\n  onSuccess?: (data: any) => any;\n  onError?: (error: Error) => any;\n}\n\nconst ConfirmationDialog: React.FC<ConfirmationDialogProps> = ({\n  title, message, acceptText, cancelText, renderTrigger: Trigger, action, onSuccess, onError\n}) => {\n  const [open, setOpen] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  const handleClickOpen = () => setOpen(true);\n  const handleClose = () => setOpen(false);\n  const handleAcceptance = () => {\n    const actionReturn = action();\n    if (!isPromise(actionReturn)) return handleClose();\n    setLoading(true);\n    actionReturn\n      .then((data: any) => {\n        onSuccess && onSuccess(data);\n      })\n      .catch((error: Error) => {\n        onError && onError(error);\n      })\n      .finally(() => { setLoading(false); handleClose(); });\n  };\n\n  return (\n    <>\n      <Trigger open={handleClickOpen} close={handleClose} />\n      <Dialog\n        open={open}\n        onClose={handleClose}\n        maxWidth=\"sm\"\n        fullWidth\n        disableEscapeKeyDown={loading}\n        disableBackdropClick={loading}\n        aria-labelledby=\"alert-dialog-title\"\n        aria-describedby=\"alert-dialog-description\"\n      >\n        <DialogTitle id=\"alert-dialog-title\">\n          {title}\n        </DialogTitle>\n        {message && (\n          <DialogContent>\n            <DialogContentText id=\"alert-dialog-description\">\n              {message}\n            </DialogContentText>\n          </DialogContent>\n        )}\n        <DialogActions>\n          <Button onClick={handleClose} color=\"secondary\" variant=\"contained\" disabled={loading}>\n            {cancelText ?? 'Cancel'}\n          </Button>\n          <Button onClick={handleAcceptance} color=\"primary\" variant=\"contained\" autoFocus disabled={loading}>\n            <ShowFirstChild inCase={loading}>\n              <CircularProgress size={20} />\n              <>{acceptText ?? 'Yes'}</>\n            </ShowFirstChild>\n            {loading}\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </>\n  );\n};\n\nexport default ConfirmationDialog;\n","import React, { useReducer } from \"react\";\n\nexport default function useCombinedState<T>(initialState: T): [T, React.Dispatch<T>] {\n\n  const [state, setState] = useReducer((prevState: T, nextState: T) => Object.assign({}, prevState, nextState), initialState);\n  \n  return [state, setState];\n}\n\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fs-lg\":\"voting-session_fs-lg__NcCB0\",\"container\":\"voting-session_container__343Kg\",\"header\":\"voting-session_header__22OUM\",\"subject\":\"voting-session_subject__2uBqO\",\"team-name-wrapper\":\"voting-session_team-name-wrapper__1ZqsG\",\"team-name\":\"voting-session_team-name__1aU_V\",\"admin-btns\":\"voting-session_admin-btns__1abX_\",\"empty\":\"voting-session_empty__1AvRl\",\"body\":\"voting-session_body__OY0Xw\",\"members-container\":\"voting-session_members-container__1yzRm\",\"cards\":\"voting-session_cards__3_dZo\",\"results\":\"voting-session_results__llr5L\",\"members\":\"voting-session_members__1dfaC\",\"member\":\"voting-session_member__1Hf5V\",\"admin-icon\":\"voting-session_admin-icon__gTCXg\",\"name-container\":\"voting-session_name-container__IGLu_\",\"name\":\"voting-session_name__2ic3f\",\"moderator\":\"voting-session_moderator__2cPuX\",\"admin\":\"voting-session_admin__1Mtmr\",\"card\":\"voting-session_card__2s2KA\",\"special-card\":\"voting-session_special-card__3H0Cl\",\"icon\":\"voting-session_icon__3sZXa\",\"number-wrapper\":\"voting-session_number-wrapper__3ORLH\",\"number\":\"voting-session_number__2u3wa\",\"number-sm\":\"voting-session_number-sm__XbEOK\",\"selected-card\":\"voting-session_selected-card__2RELS\",\"stats\":\"voting-session_stats__3UUiv\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fs-lg\":\"editable-on-click_fs-lg__3J3qF\",\"text\":\"editable-on-click_text__3uOma\",\"empty\":\"editable-on-click_empty__2EER1\",\"editable\":\"editable-on-click_editable__271Zu\",\"error\":\"editable-on-click_error__1VxBt\",\"disabled\":\"editable-on-click_disabled__2HuPQ\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"fs-lg\":\"voting-results_fs-lg__149bv\",\"container\":\"voting-results_container__34O4q\",\"avg\":\"voting-results_avg__3CBKI\",\"percentages\":\"voting-results_percentages__1qKj9\",\"percentage\":\"voting-results_percentage__t8ivr\",\"chart\":\"voting-results_chart__1clPu\"};","import { User } from \"./user\";\n\nexport interface WebSocketMessage<T> {\n  action: string\n  data?: T\n}\n\nexport type Votes = { [k: string]: number };\n\nexport type ToggleResultsDisplayMessage = { votes: Votes, show: boolean }\n\nexport interface MemberInMessage {\n  id: string\n  username: string\n}\n\nexport interface ShowCurrentMembersMessage {\n  sessionModerator: MemberInMessage\n  currentMembers: MemberInMessage[]\n}\n\nexport interface VotingWebSocket extends WebSocket {\n  state: VotingSessionState\n}\n\nexport interface VotingSessionState {\n  sessionModerator?: string\n  currentUserIsSessionModerator?: boolean\n  currentSubject?: string\n  memberVotes?: { [username: string]: number },\n  members?: { [id: string]: MemberInMessage }\n  actionSenders?: ActionSenders\n  isRunning?: boolean\n  loading?: boolean\n  resultsAreShown?: boolean\n  lockedOption?: number\n}\n\nexport interface ActionHandlerParams {\n  msg: WebSocketMessage<any>,\n  setState: React.Dispatch<VotingSessionState>,\n  conn: VotingWebSocket,\n  currentUser: User\n};\n\nexport enum Actions {\n  submitVote = 'submitVote',\n  toggleResultsDisplay = 'toggleResultsDisplay',\n  closeSession = 'closeSession',\n  displaySubject = 'displaySubject',\n  reset = 'reset',\n  changeModerator = 'changeModerator'\n}\n\nexport type ActionHandler = (params: ActionHandlerParams) => void;\nexport type ActionSenders = { [key in Actions]: (arg?: any) => void }","import { Fragment, useEffect, useRef, useState } from \"react\";\nimport { returnIfLink, showAlert } from \"../../utils/utils\";\nimport styles from './editable-on-click.module.scss';\nimport { ValidationRules } from \"../../models/validation\";\nimport { useDispatch } from \"react-redux\";\nimport ShowFirstChild from \"./show-first-child\";\n\nexport interface EditableOnClickProps {\n  onSubmit?: (text?: string) => void\n  disableEdit?: boolean,\n  initialText?: string,\n  validationRules?: ValidationRules,\n  customErrorMsg?: string\n  classes?: { input?: string, err?: string }\n  placeholder?: string\n}\n\nconst EditableOnClick = ({\n  onSubmit,\n  disableEdit,\n  initialText = '',\n  validationRules = {},\n  customErrorMsg,\n  classes,\n  placeholder = '',\n}: EditableOnClickProps) => {\n\n  const dispatch = useDispatch();\n  const { maxLength = 500, pattern } = validationRules;\n  const [applyEditableStyle, setApplyEditableStyle] = useState<boolean>(false);\n  const [text, setText] = useState<string | undefined>('');\n  const [showPlaceholder, setShowPlaceholder] = useState<boolean>(!Boolean(initialText));\n  const inputRef = useRef<HTMLAnchorElement>(null);\n\n  useEffect(() => {\n    setShowPlaceholder(!Boolean(initialText));\n    if (inputRef?.current) {\n      inputRef.current.textContent = initialText || placeholder;\n      setText(inputRef.current.textContent);\n    }\n  }, [inputRef, initialText, placeholder]);\n\n  const handleFocus = () => {\n    setShowPlaceholder(false);\n    if (inputRef.current && showPlaceholder) inputRef.current.textContent = '';\n  }\n\n  const handleBlur = () => {\n\n    const submitted = (inputRef.current?.textContent || '');\n\n    if (!submitted) {\n      setShowPlaceholder(true);\n      if (inputRef.current) inputRef.current.textContent = placeholder;\n    }\n\n    if (pattern && !pattern.test(submitted)) {\n      showAlert(dispatch, { type: 'error', content: customErrorMsg || 'Invalid value' });\n      return;\n    }\n\n    if (submitted.length > maxLength) {\n      showAlert(dispatch, { type: 'error', content: customErrorMsg || `Content cannot be larger than ${maxLength}` });\n      return;\n    }\n\n    if (inputRef?.current && submitted) inputRef.current.textContent = submitted.trim();\n    if (onSubmit) onSubmit(submitted);\n    setApplyEditableStyle(false);\n  };\n\n  const onMouseDown = !disableEdit ? () => setApplyEditableStyle(true) : undefined;\n\n  return (\n    <a\n      contentEditable={!disableEdit}\n      className={`${styles.text} ${classes?.input ?? ''} ${applyEditableStyle ? styles.editable : ''} ${showPlaceholder ? styles.empty : ''}`}\n      ref={inputRef}\n      href={returnIfLink(text)}\n      id=\"field\"\n      spellCheck=\"false\"\n      onBlur={handleBlur}\n      onFocus={handleFocus}\n      target=\"blank\"\n      onMouseDown={onMouseDown}\n      defaultValue={showPlaceholder ? placeholder : initialText}\n    >\n    </a>\n  )\n};\n\nexport default EditableOnClick;","import styles from './voting-results.module.scss';\nimport { PieChart } from 'react-minimal-pie-chart';\nimport { Data } from 'react-minimal-pie-chart/types/commonTypes';\nimport { indicativeVotingOptions } from '../../realtime/voting-connection';\n\nconst colors = [\n  'tomato',\n  'green',\n  'orange',\n  'gray',\n  'rgba(153, 102, 255, 0.2)',\n  'rgba(255, 159, 64, 0.2)',\n];\nexport interface VotingResultsProps {\n  memberVotes: { [username: string]: number }\n}\n\nconst VotingResults = ({ memberVotes }: VotingResultsProps) => {\n\n  const aggs = Object.keys(memberVotes)\n    .reduce((agg: {\n      countPerVote: { [k: string]: number },\n      avgNominator: number,\n      avgDenominator: number,\n    }, member) => {\n      const vote = memberVotes[member] || 0;\n\n      if (vote <= 0) return agg;\n\n      agg.countPerVote[vote] = agg.countPerVote[vote]\n        ? agg.countPerVote[vote] + 1\n        : 1;\n\n      agg.avgNominator += vote;\n      agg.avgDenominator++;\n\n      return agg;\n    }, {\n      countPerVote: {},\n      avgNominator: 0,\n      avgDenominator: 0,\n    });\n\n  const {\n    countPerVote = {},\n    avgDenominator = 0,\n    avgNominator = 0,\n  } = aggs;\n\n  const roundedAvg = Math.round((avgNominator / avgDenominator) * 10) / 10;\n\n  const chartData: Data = Object.keys(countPerVote)\n    .map((vote, i) => ({\n      title: vote,\n      value: countPerVote[vote],\n      color: colors[i % colors.length]\n    }));\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.avg}>\n        <strong>Average: {roundedAvg || '?'}</strong>\n      </div>\n      <div className={styles.percentages}>\n        <PieChart\n          className={styles.chart}\n          data={chartData}\n          label={({ dataEntry: { value, title } }) => `${value} vote${value > 1 ? 's' : ''} for ${title}`}\n          labelStyle={{ fontSize: '5px', fill: 'white', fontWeight: 'bold' }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default VotingResults;\n","const votingUrl = `${process.env.REACT_APP_WEBSOCKET_URL}/api/v1/voting` || '';\n\nexport default votingUrl;","import { ActionHandler, ActionSenders, Votes, MemberInMessage, ShowCurrentMembersMessage, Actions, WebSocketMessage, ToggleResultsDisplayMessage } from '../models/voting-types';\nimport votingUrl from \"../api/voting\";\nimport { VotingSessionState, VotingWebSocket } from \"../models/voting-types\";\nimport { User } from \"../models/user\";\n\n/*------------------------------------- General Settings -------------------------------------*/\n\nexport const votingOptions = [1, 2, 3, 5, 8, 13, 21, 34, 55];\nexport const indicativeVotingOptions = {\n  voted: -1,\n  unknown: -2,\n  initial: 0\n};\n\n/*------------------------------------- Action Handlers -------------------------------------*/\n\nconst closeSession: ActionHandler = ({ conn }) => {\n  conn.close();\n};\n\nconst showNewMember: ActionHandler = ({ msg, setState, conn }) => {\n\n  const newMember = msg.data as MemberInMessage;\n  const memberVotes = { ...conn.state.memberVotes };\n  const members = { ...conn.state.members, [newMember.id]: newMember }\n  memberVotes[newMember.id] = indicativeVotingOptions.initial;\n  setState({ memberVotes, members });\n};\n\nconst removeLeavingMember: ActionHandler = ({ msg, conn, setState }) => {\n\n  const leavingMember = msg.data as MemberInMessage;\n  const memberVotes = { ...conn.state.memberVotes };\n  const members = { ...conn.state.members };\n  delete memberVotes[leavingMember.id];\n  delete members[leavingMember.id]\n\n  setState({ memberVotes, members });\n};\n\nconst showCurrentMembers: ActionHandler = ({ msg, setState, currentUser }) => {\n\n  const { sessionModerator, currentMembers } = msg.data as ShowCurrentMembersMessage;\n  const membersOnTop = currentUser.id === sessionModerator.id\n    ? { [sessionModerator.id]: indicativeVotingOptions.initial }\n    : ({\n      [currentUser.id]: indicativeVotingOptions.initial,\n      [sessionModerator.id]: indicativeVotingOptions.initial\n    });\n\n  const members = currentMembers\n    .reduce((agg, m) => Object\n      .assign(agg, { [m.id]: m }), { [sessionModerator.id]: sessionModerator });\n\n  setState({\n    sessionModerator: sessionModerator.id,\n    members,\n    memberVotes: currentMembers\n      .reduce((agg, m) => m.id === currentUser.id\n        ? agg\n        : ({ ...agg, [m.id]: indicativeVotingOptions.initial }), membersOnTop),\n    loading: false\n  });\n};\n\nconst sessionCreated: ActionHandler = ({ setState, currentUser }) => {\n  setState({\n    sessionModerator: currentUser.id,\n    currentUserIsSessionModerator: true,\n    loading: false,\n    memberVotes: { [currentUser.id]: indicativeVotingOptions.initial },\n    members: { [currentUser.id]: currentUser }\n  });\n};\n\nconst displaySubject: ActionHandler = ({ msg, setState, conn }) => {\n  const currentSubject = msg.data as string;\n  const newState: VotingSessionState = {};\n  if (currentSubject !== conn.state.currentSubject) newState.currentSubject = currentSubject;\n  setState(newState);\n};\n\nconst reset: ActionHandler = ({ setState, conn }) => {\n  const newState: VotingSessionState = {\n    memberVotes: Object\n      .keys(conn.state.memberVotes || {})\n      .reduce((agg, k) => (Object.assign({}, agg, { [k]: indicativeVotingOptions.initial })), {}),\n    lockedOption: indicativeVotingOptions.initial,\n    resultsAreShown: false\n  };\n  setState(newState);\n};\n\nconst toggleResultsDisplay: ActionHandler = ({ msg, setState, conn, currentUser }) => {\n\n  const { votes = {}, show = false } = msg.data as ToggleResultsDisplayMessage || {};\n  const currentMemberVotes = conn.state.memberVotes || {}\n  const memberVotes: Votes = {};\n\n  Object.keys(currentMemberVotes).forEach(k => {\n    if (show) {\n      memberVotes[k] = votes[k];\n    } else {\n      memberVotes[k] = k === currentUser.id\n        || !currentMemberVotes[k]\n        ? currentMemberVotes[k] || indicativeVotingOptions.initial\n        : indicativeVotingOptions.voted\n    }\n  });\n\n  setState({ memberVotes, resultsAreShown: show });\n};\n\nconst showVote: ActionHandler = ({ msg, conn, setState, currentUser }) => {\n\n  const vote = msg.data as Votes;\n  const memberVotes = Object.assign({}, conn.state.memberVotes, vote);\n  const newState: VotingSessionState = { memberVotes };\n  if (vote[currentUser.id]) newState.lockedOption = vote[currentUser.id];\n  setState(newState);\n};\n\nconst changeModerator: ActionHandler = ({ msg, conn, setState, currentUser }) => {\n  const newModeratorId = msg.data as string;\n  const newState: VotingSessionState = {\n    memberVotes: Object\n      .keys(conn.state.memberVotes || {})\n      .reduce((agg, k) => (Object.assign({}, agg, { [k]: indicativeVotingOptions.initial })), {}),\n    lockedOption: indicativeVotingOptions.initial,\n    resultsAreShown: false,\n    sessionModerator: newModeratorId,\n    currentUserIsSessionModerator: currentUser.id === newModeratorId\n  };\n  setState(newState);\n};\n\nconst actionHandlers: { [key: string]: ActionHandler } = {\n  closeSession,\n  showNewMember,\n  removeLeavingMember,\n  showCurrentMembers,\n  sessionCreated,\n  displaySubject,\n  toggleResultsDisplay,\n  showVote,\n  reset,\n  changeModerator\n};\n\n/*------------------------------------- Action Senders -------------------------------------*/\n\nconst createSubmitVoteSender = (conn: VotingWebSocket) => (msg: number) => {\n  conn.send(JSON.stringify({ action: Actions.submitVote, data: msg }));\n};\n\nconst createToggleResultsDisplaySender = (conn: VotingWebSocket) => () => conn.send(JSON.stringify({ action: Actions.toggleResultsDisplay }));\n\nconst createCloseSessionSender = (conn: VotingWebSocket) => () => conn.send(JSON.stringify({ action: Actions.closeSession }));\n\nconst createDisplaySubjectSender = (conn: VotingWebSocket) => (subject: string) => {\n  conn.send(JSON.stringify({ action: Actions.displaySubject, data: subject }));\n};\n\nconst createResetSender = (conn: VotingWebSocket) => () => conn.send(JSON.stringify({ action: Actions.reset }));\n\nconst createChangeModeratorSender = (conn: VotingWebSocket) => (newModeratorId: string) => {\n  conn.send(JSON.stringify({ action: Actions.changeModerator, data: newModeratorId }));\n};\n\nconst createActionSenders = (conn: VotingWebSocket): ActionSenders => ({\n  [Actions.submitVote]: createSubmitVoteSender(conn),\n  [Actions.toggleResultsDisplay]: createToggleResultsDisplaySender(conn),\n  [Actions.closeSession]: createCloseSessionSender(conn),\n  [Actions.displaySubject]: createDisplaySubjectSender(conn),\n  [Actions.reset]: createResetSender(conn),\n  [Actions.changeModerator]: createChangeModeratorSender(conn)\n});\n\n/*------------------------------------- Initialize Connection -------------------------------------*/\n\nexport const initVotingSessionConn = (teamId: string, initialState: VotingSessionState, setState: React.Dispatch<VotingSessionState>, currentUser: User): VotingWebSocket | null => {\n\n  const conn = new WebSocket(`${votingUrl}/${teamId}`) as VotingWebSocket;\n\n  // Give the connection access to the latest state in case a handler needs it.\n  conn.state = initialState;\n  const modifiedSetState = (value: VotingSessionState) => {\n    conn.state = { ...conn.state, ...value };\n    setState(value);\n  }\n\n  conn.onopen = () => {\n    modifiedSetState({ actionSenders: createActionSenders(conn), loading: true })\n  }\n\n  conn.onmessage = ev => {\n    const msg = JSON.parse(ev.data);\n\n    if (Array.isArray(msg)) {\n\n      const messages = msg as WebSocketMessage<any>[];\n      messages.forEach(m => {\n        if (actionHandlers[m?.action]) actionHandlers[m.action]({ msg: m, setState: modifiedSetState, conn, currentUser })\n      });\n\n    } else {\n\n      const message = msg as WebSocketMessage<any>;\n      if (actionHandlers[msg?.action]) actionHandlers[msg.action]({ msg: message, setState: modifiedSetState, conn, currentUser });\n    }\n  };\n\n  conn.onclose = () => {\n    modifiedSetState({ ...initialState, isRunning: false, loading: false });\n  };\n\n  conn.onerror = (e) => {\n    conn.close();\n  }\n\n  return conn;\n};\n","import Button from '@material-ui/core/Button';\nimport { Fragment, useEffect } from \"react\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useHistory, useParams } from \"react-router-dom\";\nimport useCombinedState from \"../../hooks/use-combined-state\";\nimport { VotingSessionState } from \"../../models/voting-types\";\nimport { User } from \"../../models/user\";\nimport { RootState, TeamsState } from \"../../models/state-types\";\nimport ShowFirstChild from \"../utils/show-first-child\";\nimport styles from './voting-session.module.scss';\nimport EditableOnClick from \"../utils/editable-on-click\";\nimport ConfirmationDialog from \"../utils/confirmation-dialog\";\nimport { getCssClasses, showAlert } from \"../../utils/utils\";\nimport CheckCircleIcon from '@material-ui/icons/CheckCircle';\nimport VotingResults from \"./voting-results\";\nimport Loading from \"../utils/loading\";\nimport callApi from '../../api/call-api';\nimport teamApi from '../../api/team';\nimport { indicativeVotingOptions, initVotingSessionConn, votingOptions } from '../../realtime/voting-connection';\nimport Team from '../../models/team';\nimport { RiAdminLine, RiAdminFill } from 'react-icons/ri';\n\ninterface TeamState {\n  team?: Team\n  loadingTeam?: boolean\n  teamApiError?: string\n}\n\nconst initialState: VotingSessionState = {\n  sessionModerator: '',\n  currentUserIsSessionModerator: false,\n  currentSubject: '',\n  members: {},\n  memberVotes: {},\n  isRunning: true,\n  resultsAreShown: false\n};\n\nconst votesUiMap = new Map<number | null, string | JSX.Element>([\n  [indicativeVotingOptions.voted, <CheckCircleIcon classes={{ root: styles.icon }} />],\n  [indicativeVotingOptions.unknown, '?'],\n  [indicativeVotingOptions.initial, '']\n]);\n\nconst getVoteInUi = (vote: number | null) => {\n  const text = votesUiMap.get(vote);\n  if (text && typeof text !== 'string') return text;\n  return (\n    <p className={styles['number-wrapper']}>\n      <span className={Number(vote) >= 10 ? styles.number : styles.number + ' ' + styles['number-sm']}>{text === undefined ? vote : text}</span>\n    </p>\n  );\n};\n\nconst VotingSession = () => {\n\n  const dispatch = useDispatch();\n  const { teamId } = useParams<{ [key: string]: string; }>();\n  const history = useHistory();\n\n  const { data: teams } = useSelector<RootState, TeamsState>(state => state.teams);\n  const [{ team, loadingTeam }, setTeamState] = useCombinedState<TeamState>({});\n\n  useEffect(() => {\n    if (teams && teams[teamId]) {\n      setTeamState({ team: teams[teamId], loadingTeam: false });\n      return;\n    }\n    callApi(teamApi.getUrl(teamId))\n      .then((res) => {\n        setTeamState({ loadingTeam: false, team: res });\n      })\n      .catch(() => {\n        setTeamState({ loadingTeam: false, teamApiError: 'Error while fetching team' });\n      });\n  }, [teamId]);\n\n  const user = useSelector<RootState, User>(state => state.user.data as User);\n\n  const [state, setState] = useCombinedState(initialState);\n\n  const {\n    memberVotes = {},\n    members = {},\n    sessionModerator = '',\n    actionSenders,\n    isRunning,\n    currentUserIsSessionModerator = false,\n    loading = true,\n    currentSubject = '',\n    resultsAreShown,\n    lockedOption,\n  } = state;\n\n  useEffect(() => {\n    if (!isRunning) {\n      showAlert(dispatch, {\n        type: 'error',\n        content: 'Voting ended by moderator',\n      });\n      history.push('/');\n      return;\n    }\n    const initialConn = initVotingSessionConn(teamId, initialState, setState, user);\n    return () => {\n      if (initialConn) initialConn.close();\n    };\n  }, [isRunning]);\n\n\n  if (!loading && !isRunning && !actionSenders) {\n    showAlert(dispatch, {\n      type: 'error',\n      content: 'Already Joined'\n    });\n    history.push('/');\n    return null;\n  }\n\n  if (loading || loadingTeam || !actionSenders || !team) return <Loading />;\n\n  const handleCardClick = (e: React.MouseEvent<HTMLDivElement>) => {\n    if (resultsAreShown) return;\n    setState({ lockedOption: indicativeVotingOptions.initial });\n    actionSenders?.submitVote(+e.currentTarget.id);\n  };\n\n  const handleEndVoting = () => history.push('/');\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.header}>\n        <div className={styles['team-name-wrapper']} title={team.name}>\n          <strong className={styles['team-name']}>{team.name}</strong>\n        </div>\n        <div className={styles.subject}>\n          <EditableOnClick\n            onSubmit={(subject) => actionSenders.displaySubject(subject)}\n            disableEdit={!currentUserIsSessionModerator}\n            initialText={currentSubject}\n            validationRules={{ maxLength: 200 }}\n            placeholder={currentUserIsSessionModerator ? 'Enter Voting Subject' : 'Voting Subject'}\n          />\n        </div>\n        <div className={styles['admin-btns']}>\n          <ShowFirstChild inCase={currentUserIsSessionModerator}>\n            <Fragment>\n              <Button\n                variant=\"outlined\" color=\"primary\"\n                onClick={() => actionSenders.reset()}>\n                Reset\n              </Button>\n              <Button\n                variant=\"contained\"\n                color=\"primary\"\n                onClick={actionSenders.toggleResultsDisplay}>\n                {resultsAreShown ? 'Hide' : 'Show'} Results\n              </Button>\n              <ConfirmationDialog\n                renderTrigger={({ open }) => (\n                  <Button variant=\"contained\" color=\"secondary\" onClick={open}>End</Button>\n                )}\n                action={handleEndVoting}\n                title={`Are you sure you want to end voting for ${team.name} ?`}\n                acceptText=\"Yes\"\n                cancelText=\"Cancel\"\n              />\n            </Fragment>\n            <Button variant=\"contained\" color=\"secondary\" onClick={handleEndVoting}>Leave</Button>\n          </ShowFirstChild>\n        </div>\n\n      </div>\n      <div className={styles.body}>\n        <div className={styles['members-container']}>\n          <div className={styles.admin}>\n            <div className={styles.moderator} title={members[sessionModerator]?.username}>\n              <strong>Moderator: {members[sessionModerator]?.username}</strong>\n            </div>\n          </div>\n          <div className={styles.members}>\n            {[...Object.keys(memberVotes).map(k => (\n              <div key={k} className={styles.member}>\n                <p className={styles['name-container']} title={members[k].username}>\n                  {\n                    currentUserIsSessionModerator\n                    &&\n                    <span className={styles['admin-icon']}>\n                      {k === sessionModerator ?\n                        <RiAdminFill title=\"Current Moderator\" />\n                        :\n                        <ConfirmationDialog\n                          renderTrigger={({ open }) => (\n                            <RiAdminLine title=\"Make Moderator\" onClick={open} />\n                          )}\n                          action={() => actionSenders?.changeModerator(k)}\n                          title={`Are you sure you want to make ${members[k].username} the moderator?`}\n                          acceptText=\"Yes\"\n                          cancelText=\"Cancel\"\n                        />\n                      }\n                    </span>\n                  }\n                  <span className={styles.name}>{members[k].username}</span>\n                </p>\n                {getVoteInUi(memberVotes[k])}\n              </div>\n            ))]}\n          </div>\n        </div>\n        <div className={styles.cards}>\n          {votingOptions.map(o => (\n            <div\n              key={o}\n              className={lockedOption === o ? getCssClasses(styles, 'card', 'selected-card') : styles.card}\n              id={o.toString()}\n              onClick={handleCardClick}>{o}</div>\n          ))}\n          <div\n            key='?'\n            className={lockedOption === indicativeVotingOptions.unknown ?\n              getCssClasses(styles, 'card', 'special-card', 'selected-card')\n              :\n              getCssClasses(styles, 'card', 'special-card')\n            }\n            id={indicativeVotingOptions.unknown.toString()} onClick={handleCardClick}>\n            ?\n          </div>\n\n        </div>\n        <div className={styles.results}>\n          <div className={styles.stats}>\n            <strong>Voted: {Object\n              .values(memberVotes)\n              .filter(v => v && v !== indicativeVotingOptions.initial)\n              .length\n            }</strong>\n            <strong>Joined: {Object.keys(members).length}</strong>\n          </div>\n          <ShowFirstChild inCase={Boolean(resultsAreShown)}>\n            <VotingResults memberVotes={memberVotes} />\n          </ShowFirstChild>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default VotingSession;"],"sourceRoot":""}